// TODO: first fix the threading problem